<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç¾å°‘å¥³è¨˜å¸³æœ¬</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root { --bright-pink: #daa4a4; --hover-pink: #daa4a4; --text-gray: #444; }
        
        body { 
            background-color: #FFFFFF; 
            background-size: cover; 
            background-position: center; 
            background-attachment: fixed;
            font-family: "Microsoft JhengHei", sans-serif; 
            display: flex; 
            flex-direction: column; 
            align-items: center; 
            justify-content: center; /* è®“æ¡†æ¡†ç½®ä¸­ */
            padding: 20px; 
            color: var(--text-gray); 
            margin: 0;
            height: 100vh; /* å›ºå®šè¦–çª—é«˜åº¦ */
            overflow: hidden; /* é˜²æ­¢èƒŒæ™¯äº‚å‹• */
        }

        /* èª¿æ•´å¾Œçš„ç™½è‰²å¤§æ¡†æ¡† */
        .card { 
            background: rgba(255, 255, 255, 0.92); 
            padding: 20px; 
            border: 1px solid #f0f0f0;
            border-radius: 20px; 
            box-shadow: 0 4px 15px rgba(0,0,0,0.1); 
            width: 95%; /* æ©«å‘æ¥è¿‘æ»¿ç‰ˆ */
            max-width: 700px; 
            max-height: 65vh; /* ç›´å‘é«˜åº¦ä½”è¢å¹• 65%ï¼Œä¸è®“å®ƒæ»¿ç‰ˆ */
            overflow-y: auto; /* å…§å®¹å¤ªå¤šæ™‚å¯ä»¥åœ¨æ¡†å…§æ²å‹• */
            box-sizing: border-box;
            text-align: center;
        }

        /* éš±è—æ²è»¸ä½†ä¿ç•™åŠŸèƒ½ (ç¾è§€ç”¨) */
        .card::-webkit-scrollbar { width: 0; }

        .title-box {
            background-color: var(--bright-pink);
            color: white;
            padding: 10px 20px;
            border-radius: 12px;
            display: inline-block;
            margin-bottom: 20px;
        }
        h1 { font-size: 1.6rem; margin: 0; color: white; }

        .info-bar { margin-bottom: 15px; color: var(--bright-pink); font-weight: bold; }
        .info-total { font-size: 1.1rem; }

        .input-group {
            display: flex;
            flex-wrap: wrap; 
            justify-content: center;
            gap: 8px;
            margin-bottom: 12px;
        }

        input, select { 
            padding: 10px; 
            border: 2px solid var(--bright-pink); 
            border-radius: 10px; 
            outline: none; 
            font-size: 0.95rem;
            flex: 1; 
            min-width: 100px; 
        }

        button { 
            background-color: var(--bright-pink); 
            color: white; 
            border: none; 
            padding: 10px 20px; 
            border-radius: 10px; 
            cursor: pointer; 
            font-weight: bold; 
            font-size: 1rem; 
        }

        .category-manage { margin-top: 15px; font-size: 0.8rem; }
        .category-manage input { width: 100px; }

        #chartBox { margin-top: 10px; width: 100%; }
        
        .backup-section {
            margin-top: 25px;
            padding-top: 15px;
            border-top: 1px dashed #eee;
        }
        .backup-btn { background-color: #aaa; font-size: 0.8rem; padding: 6px 12px; }

        .bg-settings { margin-top: 20px; }
        .bg-btn { background: #eee; color: #888; border: none; padding: 5px 10px; border-radius: 5px; font-size: 0.7rem; cursor: pointer; }
    </style>
</head>
<body>

    <div class="card">
        <div class="title-box">
            <h1>ç¾å°‘å¥³è¨˜å¸³æœ¬ğŸ‘¸ğŸ»</h1>
        </div>

        <div class="info-bar">
            <span id="monthTotalLabel" class="info-total">ç•¶æœˆç¸½è¨ˆ: $0</span>
        </div>

        <div class="input-group">
            <input type="date" id="recordDate">
            <input type="number" id="amount" placeholder="é‡‘é¡" step="any">
            <select id="categorySelect"></select>
            <button onclick="addRecord()">æ–°å¢ç´€éŒ„</button>
        </div>

        <div class="category-manage">
            <input type="text" id="newCategoryName" placeholder="æ–°é¡åˆ¥">
            <button onclick="addCategory()">æ–°å¢</button>
            <button onclick="deleteCategory()" style="background: #daa4a4;">åˆªé™¤</button>
        </div>

        <hr style="border:0; border-top: 1px solid #eee; margin: 20px 0;">

        <div>
            <button onclick="showStats('month')">ç•¶æœˆåœ–è¡¨</button>
            <button onclick="showStats('year')">ä»Šå¹´åœ–è¡¨</button>
        </div>

        <div id="chartBox">
            <div id="summaryLabel" style="font-size:1.1rem; color:var(--bright-pink); font-weight:bold; margin:10px;"></div>
            <canvas id="myChart"></canvas>
        </div>

        <div class="backup-section">
            <p style="font-size: 0.9rem; color: #bbb; margin-bottom: 5px;">ğŸ”’å®šæœŸå‚™ä»½</p>
            <button class="backup-btn" onclick="exportData()">ä¸‹è¼‰å‚™ä»½</button>
            <button class="backup-btn" onclick="document.getElementById('fileInput').click()">åŒ¯å…¥å‚™ä»½</button>
            <input type="file" id="fileInput" style="display:none" onchange="importData(event)">
        </div>

        <div class="bg-settings">
            <button class="bg-btn" onclick="document.getElementById('bgInput').click()">ğŸ–¼ï¸ æ›´æ›èƒŒæ™¯</button>
            <button class="bg-btn" onclick="clearBg()">é‡ç½®èƒŒæ™¯</button>
            <input type="file" id="bgInput" style="display:none" accept="image/*" onchange="uploadBg(event)">
        </div>
    </div>

    <script>
        let records = JSON.parse(localStorage.getItem('girl_records_v3')) || [];
        let categories = JSON.parse(localStorage.getItem('girl_cats_v3')) || ["åƒé£¯", "è¡£æœ", "äº¤é€š"];
        let myChart = null;

        function initHeader() {
            const now = new Date();
            document.getElementById('recordDate').valueAsDate = now;
            const monthTotal = records.reduce((sum, r) => {
                const rDate = new Date(r.date);
                if(rDate.getMonth() === now.getMonth() && rDate.getFullYear() === now.getFullYear()) return sum + r.amt;
                return sum;
            }, 0);
            document.getElementById('monthTotalLabel').innerText = `ç•¶æœˆç¸½è¨ˆ: $${monthTotal}`;
            const savedBg = localStorage.getItem('girl_custom_bg');
            if (savedBg) { document.body.style.backgroundImage = `url(${savedBg})`; }
        }

        function uploadBg(event) {
            const file = event.target.files[0]; if (!file) return;
            const reader = new FileReader();
            reader.onload = function(e) {
                localStorage.setItem('girl_custom_bg', e.target.result);
                document.body.style.backgroundImage = `url(${e.target.result})`;
            };
            reader.readAsDataURL(file);
        }

        function clearBg() { localStorage.removeItem('girl_custom_bg'); location.reload(); }

        function updateCategoryDropdown() {
            const select = document.getElementById('categorySelect'); select.innerHTML = '';
            categories.forEach(cat => { const opt = document.createElement('option'); opt.value = cat; opt.innerText = cat; select.appendChild(opt); });
        }

        function addCategory() {
            const name = document.getElementById('newCategoryName').value.trim();
            if(!name || categories.includes(name)) return;
            categories.push(name); localStorage.setItem('girl_cats_v3', JSON.stringify(categories));
            updateCategoryDropdown();
        }

        function deleteCategory() {
            const selectedCat = document.getElementById('categorySelect').value;
            if(!selectedCat || !confirm(`åˆªé™¤ã€Œ${selectedCat}ã€ï¼Ÿ`)) return;
            categories = categories.filter(c => c !== selectedCat); localStorage.setItem('girl_cats_v3', JSON.stringify(categories));
            updateCategoryDropdown();
        }

        function addRecord() {
            const amt = document.getElementById('amount').value; const cat = document.getElementById('categorySelect').value; const date = document.getElementById('recordDate').value;
            if(!amt || !cat || !date) return alert("è«‹å¡«å…¥è³‡æ–™ï¼");
            records.push({ amt: parseFloat(amt), cat: cat, date: new Date(date).toISOString() });
            localStorage.setItem('girl_records_v3', JSON.stringify(records));
            document.getElementById('amount').value = ''; initHeader(); alert("è¨˜å¥½å›‰ï¼âœ¨");
        }

        function showStats(type) {
            document.getElementById('chartBox').style.display = 'block';
            const now = new Date();
            const filtered = records.filter(r => { const d = new Date(r.date); return type === 'month' ? (d.getMonth() === now.getMonth() && d.getFullYear() === now.getFullYear()) : (d.getFullYear() === now.getFullYear()); });
            let total = 0; const stats = {};
            filtered.forEach(r => { total += r.amt; stats[r.cat] = (stats[r.cat] || 0) + r.amt; });
            document.getElementById('summaryLabel').innerText = (type === 'month' ? "æœ¬æœˆ" : "ä»Šå¹´") + "æ”¯å‡ºï¼š$" + total;
            if(myChart) myChart.destroy();
            myChart = new Chart(document.getElementById('myChart'), { type: 'pie', data: { labels: Object.keys(stats), datasets: [{ data: Object.values(stats), backgroundColor: ['#FFB7C5', '#FFD1DC', '#FFC0CB', '#FF9EAF', '#FF85A2'] }] } });
        }

        function exportData() {
            const data = { records, categories }; const blob = new Blob([JSON.stringify(data)], {type: "application/json"});
            const url = URL.createObjectURL(blob); const a = document.createElement('a'); a.href = url; a.download = "å‚™ä»½.json"; a.click();
        }

        function importData(e) {
            const file = e.target.files[0]; if(!file) return;
            const reader = new FileReader();
            reader.onload = function(evt) { const imported = JSON.parse(evt.target.result); records = imported.records || []; categories = imported.categories || []; localStorage.setItem('girl_records_v3', JSON.stringify(records)); localStorage.setItem('girl_cats_v3', JSON.stringify(categories)); location.reload(); };
            reader.readAsText(file);
        }

        updateCategoryDropdown(); initHeader();
    </script>
</body>
</html>
