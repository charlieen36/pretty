<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç¾å°‘å¥³è¨˜å¸³æœ¬</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root { --bright-pink: #daa4a4; --hover-pink: #daa4a4; --text-gray: #444; }
        
        body { 
            background-color: #000000; /* èƒŒæ™¯åº•è‰²æ”¹é»‘è‰²ï¼Œæ²’ç…§ç‰‡çš„åœ°æ–¹æ¯”è¼ƒä¸çªå…€ */
            background-size: contain; /* ç¢ºä¿ 9:16 ç…§ç‰‡å®Œæ•´é¡¯ç¤ºä¸è£åˆ‡ */
            background-position: center; 
            background-repeat: no-repeat; /* é˜²æ­¢ç…§ç‰‡é‡è¤‡å‡ºç¾ */
            background-attachment: fixed;
            font-family: "Microsoft JhengHei", sans-serif; 
            display: flex; 
            flex-direction: column; 
            align-items: center; 
            justify-content: flex-start; 
            padding: 20px; 
            color: var(--text-gray); 
            margin: 0;
            height: 100vh;
            overflow: hidden;
        }

        /* å°å·§ã€åŠé€æ˜ã€åä¸Šçš„æ¡†æ¡† */
        .card { 
            background: rgba(255, 255, 255, 0.7); 
            padding: 15px; 
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 20px; 
            box-shadow: 0 4px 15px rgba(0,0,0,0.2); 
            width: 92%; 
            max-width: 450px; 
            max-height: 50vh; /* é«˜åº¦å†ç¸®ä¸€é»é»ï¼Œç•™æ›´å¤šç©ºé–“çœ‹åœ– */
            overflow-y: auto;
            box-sizing: border-box;
            text-align: center;
            backdrop-filter: blur(3px);
            margin-top: 10px;
        }

        .card::-webkit-scrollbar { width: 0; }

        .title-box {
            background-color: var(--bright-pink);
            color: white;
            padding: 6px 15px;
            border-radius: 10px;
            display: inline-block;
            margin-bottom: 12px;
        }
        h1 { font-size: 1.3rem; margin: 0; color: white; }

        .info-bar { margin-bottom: 10px; color: var(--bright-pink); font-weight: bold; }
        .info-total { font-size: 0.95rem; }

        .input-group {
            display: flex;
            flex-wrap: wrap; 
            justify-content: center;
            gap: 5px;
            margin-bottom: 8px;
        }

        input, select { 
            padding: 7px; 
            border: 2px solid var(--bright-pink); 
            border-radius: 8px; 
            outline: none; 
            font-size: 0.85rem;
            flex: 1; 
            min-width: 85px; 
        }

        button { 
            background-color: var(--bright-pink); 
            color: white; 
            border: none; 
            padding: 7px 14px; 
            border-radius: 8px; 
            cursor: pointer; 
            font-weight: bold; 
            font-size: 0.9rem; 
        }

        .category-manage { margin-top: 8px; font-size: 0.7rem; }
        .category-manage input { width: 75px; padding: 5px; }
        .category-manage button { padding: 4px 8px; font-size: 0.7rem; }

        #chartBox { margin-top: 8px; width: 100%; }
        
        .backup-section {
            margin-top: 15px;
            padding-top: 10px;
            border-top: 1px dashed rgba(218, 164, 164, 0.3);
        }
        .backup-btn { background-color: #aaa; font-size: 0.7rem; padding: 4px 8px; }

        .bg-settings { margin-top: 12px; }
        .bg-btn { background: rgba(238, 238, 238, 0.6); color: #444; border: none; padding: 4px 8px; border-radius: 5px; font-size: 0.65rem; cursor: pointer; }
    </style>
</head>
<body>

    <div class="card">
        <div class="title-box">
            <h1>ç¾å°‘å¥³è¨˜å¸³æœ¬ğŸ‘¸ğŸ»</h1>
        </div>

        <div class="info-bar">
            <span id="monthTotalLabel" class="info-total">ç•¶æœˆç¸½è¨ˆ: $0</span>
        </div>

        <div class="input-group">
            <input type="date" id="recordDate">
            <input type="number" id="amount" placeholder="é‡‘é¡" step="any">
            <select id="categorySelect"></select>
            <button onclick="addRecord()">æ–°å¢</button>
        </div>

        <div class="category-manage">
            <input type="text" id="newCategoryName" placeholder="æ–°é¡åˆ¥">
            <button onclick="addCategory()">+é¡åˆ¥</button>
            <button onclick="deleteCategory()" style="background: #daa4a4;">-é¡åˆ¥</button>
        </div>

        <hr style="border:0; border-top: 1px solid #eee; margin: 12px 0;">

        <div>
            <button onclick="showStats('month')" style="font-size: 0.8rem;">æœ¬æœˆåœ–è¡¨</button>
            <button onclick="showStats('year')" style="font-size: 0.8rem;">ä»Šå¹´åœ–è¡¨</button>
        </div>

        <div id="chartBox">
            <div id="summaryLabel" style="font-size:0.9rem; color:var(--bright-pink); font-weight:bold; margin:8px;"></div>
            <canvas id="myChart"></canvas>
        </div>

        <div class="backup-section">
            <button class="backup-btn" onclick="exportData()">ä¸‹è¼‰å‚™ä»½</button>
            <button class="backup-btn" onclick="document.getElementById('fileInput').click()">åŒ¯å…¥å‚™ä»½</button>
            <input type="file" id="fileInput" style="display:none" onchange="importData(event)">
        </div>

        <div class="bg-settings">
            <button class="bg-btn" onclick="document.getElementById('bgInput').click()">ğŸ–¼ï¸ æ›´æ›å®Œæ•´èƒŒæ™¯</button>
            <button class="bg-btn" onclick="clearBg()">é‡ç½®</button>
            <input type="file" id="bgInput" style="display:none" accept="image/*" onchange="uploadBg(event)">
        </div>
    </div>

    <script>
        let records = JSON.parse(localStorage.getItem('girl_records_v4')) || [];
        let categories = JSON.parse(localStorage.getItem('girl_cats_v4')) || ["åƒé£¯", "è¡£æœ", "äº¤é€š"];
        let myChart = null;

        function initHeader() {
            const now = new Date();
            document.getElementById('recordDate').valueAsDate = now;
            const monthTotal = records.reduce((sum, r) => {
                const rDate = new Date(r.date);
                if(rDate.getMonth() === now.getMonth() && rDate.getFullYear() === now.getFullYear()) return sum + r.amt;
                return sum;
            }, 0);
            document.getElementById('monthTotalLabel').innerText = `ç•¶æœˆç¸½è¨ˆ: $${monthTotal}`;
            const savedBg = localStorage.getItem('girl_custom_bg_v4');
            if (savedBg) { document.body.style.backgroundImage = `url(${savedBg})`; }
        }

        function uploadBg(event) {
            const file = event.target.files[0]; if (!file) return;
            const reader = new FileReader();
            reader.onload = function(e) {
                localStorage.setItem('girl_custom_bg_v4', e.target.result);
                document.body.style.backgroundImage = `url(${e.target.result})`;
            };
            reader.readAsDataURL(file);
        }

        function clearBg() { localStorage.removeItem('girl_custom_bg_v4'); location.reload(); }

        function updateCategoryDropdown() {
            const select = document.getElementById('categorySelect'); select.innerHTML = '';
            categories.forEach(cat => { const opt = document.createElement('option'); opt.value = cat; opt.innerText = cat; select.appendChild(opt); });
        }

        function addCategory() {
            const name = document.getElementById('newCategoryName').value.trim();
            if(!name || categories.includes(name)) return;
            categories.push(name); localStorage.setItem('girl_cats_v4', JSON.stringify(categories));
            updateCategoryDropdown();
        }

        function deleteCategory() {
            const selectedCat = document.getElementById('categorySelect').value;
            if(!selectedCat || !confirm(`åˆªé™¤ã€Œ${selectedCat}ã€ï¼Ÿ`)) return;
            categories = categories.filter(c => c !== selectedCat); localStorage.setItem('girl_cats_v4', JSON.stringify(categories));
            updateCategoryDropdown();
        }

        function addRecord() {
            const amt = document.getElementById('amount').value; const cat = document.getElementById('categorySelect').value; const date = document.getElementById('recordDate').value;
            if(!amt || !cat || !date) return alert("å¡«ä¸€ä¸‹é‡‘é¡å•¦ï¼");
            records.push({ amt: parseFloat(amt), cat: cat, date: new Date(date).toISOString() });
            localStorage.setItem('girl_records_v4', JSON.stringify(records));
            document.getElementById('amount').value = ''; initHeader(); alert("è¨˜å¥½äº†ğŸ’–");
        }

        function showStats(type) {
            document.getElementById('chartBox').style.display = 'block';
            const now = new Date();
            const filtered = records.filter(r => { const d = new Date(r.date); return type === 'month' ? (d.getMonth() === now.getMonth() && d.getFullYear() === now.getFullYear()) : (d.getFullYear() === now.getFullYear()); });
            let total = 0; const stats = {};
            filtered.forEach(r => { total += r.amt; stats[r.cat] = (stats[r.cat] || 0) + r.amt; });
            document.getElementById('summaryLabel').innerText = (type === 'month' ? "æœ¬æœˆ" : "ä»Šå¹´") + "ï¼š$" + total;
            if(myChart) myChart.destroy();
            myChart = new Chart(document.getElementById('myChart'), { type: 'pie', data: { labels: Object.keys(stats), datasets: [{ data: Object.values(stats), backgroundColor: ['#FFB7C5', '#FFD1DC', '#FFC0CB', '#FF9EAF', '#FF85A2'] }] } });
        }

        function exportData() {
            const data = { records, categories }; const blob = new Blob([JSON.stringify(data)], {type: "application/json"});
            const url = URL.createObjectURL(blob); const a = document.createElement('a'); a.href = url; a.download = "å‚™ä»½.json"; a.click();
        }

        function importData(e) {
            const file = e.target.files[0]; if(!file) return;
            const reader = new FileReader();
            reader.onload = function(evt) { const imported = JSON.parse(evt.target.result); records = imported.records || []; categories = imported.categories || []; localStorage.setItem('girl_records_v4', JSON.stringify(records)); localStorage.setItem('girl_cats_v4', JSON.stringify(categories)); location.reload(); };
            reader.readAsText(file);
        }

        updateCategoryDropdown(); initHeader();
    </script>
</body>
</html>
